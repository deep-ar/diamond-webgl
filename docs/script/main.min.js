!function(){"use strict";var e={592:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Drawer=void 0;var i=r(62),n=r(841),a=r(61),o=r(817);r(457);var s=new Float32Array([-.5,-.5,-.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5]),u=function(){function e(e){var t=this;Page.Canvas.showLoader(!0),this.gl=e,this.cubeVBO=new i.VBO(e,s,3,e.FLOAT,!0),this.geometryVBO=e.createBuffer(),this.shader=new o.LazyShader("shader.frag","shader.vert","default shader"),this.shaderMulticolor=new o.LazyShader("shader-multicolor.frag","shader.vert","shader with dispersion"),this.raytracedVolumeShader=new o.LazyShader("raytracedVolume.frag","raytracedVolume.vert","debug raytraced shader"),this.normalsShader=new o.LazyShader("normals.frag","shader.vert","normals shader"),this.shadersSkybox=new o.LazyShader("skybox.frag","skybox.vert","skybox shader"),this.pMatrix=mat4.create(),this.mvpMatrix=mat4.create(),this.camera=new n.OrbitalCamera([0,0,0],1.5),this.camera.phi=1,this.camera.theta=2;var r=Math.PI-1e-4;function u(){var t=a.Parameters.backgroundColor;e.clearColor(t.r/255,t.g/255,t.b/255,.1)}Page.Canvas.Observers.mouseDrag.push((function(e,i){t.camera.theta-=3.14159*e,t.camera.phi-=3*i,t.camera.phi=Math.min(r,Math.max(1e-4,t.camera.phi)),t.updateMVPMatrix()})),Page.Canvas.Observers.mouseWheel.push((function(e){var r=t.camera.distance+.2*e;r=Math.min(8,Math.max(.8,r)),t.camera.distance=r,t.updateMVPMatrix()})),Page.Canvas.Observers.canvasResize.push((function(){t.updateMVPMatrix()})),a.Parameters.addCameraChangeObservers((function(){t.updateMVPMatrix()})),this.updateMVPMatrix(),e.enable(e.CULL_FACE),e.frontFace(e.CCW),e.cullFace(e.BACK),e.disable(e.DEPTH_TEST),e.disable(e.BLEND),a.Parameters.addBackgroundColorObserver(u),u(),a.Parameters.addRecomputeShaderObservers((function(){var e=t.computeInjectedInstructions();t.shader.reset(e)}))}return e.prototype.setGemstone=function(e){if(this.gemstone!==e){this.gemstone=e,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.geometryVBO),this.gl.bufferData(this.gl.ARRAY_BUFFER,e.bufferData,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null);var t=this.computeInjectedInstructions();this.shader.reset(t),this.shaderMulticolor.reset(t),this.raytracedVolumeShader.reset(t),Page.Canvas.setIndicatorText("triangles-count-indicator",e.nbTriangles.toString()),Page.Canvas.setIndicatorText("facets-count-indicator",e.facets.length.toString());var r="shape_not_convex";this.gemstone.isConvex?Page.Demopage.setErrorMessage(r,""):Page.Demopage.setErrorMessage(r,"The current geometry is not supported. The simulation will not look as expected.")}},e.prototype.rotate=function(e){this.camera.theta+=e,this.updateMVPMatrix()},e.prototype.draw=function(){if(this.gl.clear(this.gl.COLOR_BUFFER_BIT),a.Parameters.displaySkybox&&this.drawSkybox(),this.gemstone){var e;if(a.Parameters.geometryOnly){if(!(e=this.normalsShader.shader))return}else{var t=a.Parameters.lightType===a.ELightType.ASET,r=a.Parameters.refractionIndex,i=a.Parameters.dispersion,n=Math.min(i,r-1);if(n<=0||t||a.Parameters.displayNormals){if(!(e=this.shader.shader))return;e.u.uRefractionIndex.value=a.Parameters.refractionIndex,e.u.uASETSkybox.value=t?1:0,e.u.uDisplayNormals.value=a.Parameters.displayNormals?1:0}else{if(!(e=this.shaderMulticolor.shader))return;e.u.uRefractionIndices.value=[r-.5*n,r,r+.5*n]}if(e.u.uEyePosition.value=this.camera.eyePos,e.u.uOrthographic.value=a.Parameters.projection===a.EProjection.ORTHOGRAPHIC?1:0,e.u.uLightDirection.value=a.Parameters.lightDirection===a.ELightDirection.DOWNWARD?1:-1,e.u.uDisplayReflection.value=a.Parameters.displayReflection?1:0,void 0!==e.u.uAbsorption){var o=a.Parameters.absorption,s=t?{r:250,g:250,b:250}:a.Parameters.gemColor;e.u.uAbsorption.value=[o*(1-s.r/255),o*(1-s.g/255),o*(1-s.b/255)]}}Page.Canvas.showLoader(!1),e.u.uMVPMatrix.value=this.mvpMatrix,e.use(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.geometryVBO);var u=e.a.aPosition.loc;this.gl.enableVertexAttribArray(u),this.gl.vertexAttribPointer(u,3,this.gl.FLOAT,!1,24,0);var c=e.a.aNormal.loc;this.gl.enableVertexAttribArray(c),this.gl.vertexAttribPointer(c,3,this.gl.FLOAT,!1,24,12),e.bindUniformsAndAttributes(),this.gl.drawArrays(this.gl.TRIANGLES,0,3*this.gemstone.nbTriangles)}},e.prototype.drawDebugVolume=function(){if(this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gemstone){var e=this.raytracedVolumeShader.shader;e&&(Page.Canvas.showLoader(!1),e.a.aPosition.VBO=this.cubeVBO,e.u.uMVPMatrix.value=this.mvpMatrix,e.u.uEyePosition.value=this.camera.eyePos,e.u.uOrthographic.value=a.Parameters.projection===a.EProjection.ORTHOGRAPHIC?1:0,e.use(),e.bindUniformsAndAttributes(),this.gl.drawArrays(this.gl.TRIANGLES,0,36))}},e.prototype.drawSkybox=function(){var e=this.shadersSkybox.shader;e&&(e.a.aPosition.VBO=this.cubeVBO,e.u.uMVPMatrix.value=this.mvpMatrix,e.u.uEyePosition.value=this.camera.eyePos,e.u.uOrthographic.value=a.Parameters.projection===a.EProjection.ORTHOGRAPHIC?1:0,e.u.uASETSkybox.value=a.Parameters.lightType===a.ELightType.ASET?1:0,e.u.uLightDirection.value=a.Parameters.lightDirection===a.ELightDirection.DOWNWARD?1:-1,e.use(),e.bindUniformsAndAttributes(),this.gl.drawArrays(this.gl.TRIANGLES,0,36))},e.prototype.updateMVPMatrix=function(){var e=Page.Canvas.getAspectRatio();if(a.Parameters.projection===a.EProjection.PERSPECTIVE)mat4.perspective(this.pMatrix,45,e,.1,50);else{var t=.5*this.camera.distance;mat4.ortho(this.pMatrix,-t*e,t*e,-t,t,.1,50)}mat4.multiply(this.mvpMatrix,this.pMatrix,this.camera.viewMatrix)},e.prototype.computeInjectedInstructions=function(){for(var e=[],t=[],r=[],i=[],n=0;n<this.gemstone.facets.length;n++){var o=this.gemstone.facets[n],s="FACET_".concat(n,"_POINT"),u="FACET_".concat(n,"_NORMAL");e.push("const vec3 ".concat(s," = vec3(").concat(o.point.x,",").concat(o.point.y,",").concat(o.point.z,");")),e.push("const vec3 ".concat(u," = vec3(").concat(o.normal.x,",").concat(o.normal.y,",").concat(o.normal.z,");")),t.push("computeIntersectionWithPlane(".concat(s,", ").concat(u,", eyePosition, fromEyeNormalized, theta, facetNormal);")),r.push("isInside(".concat(s,", ").concat(u,", entryPoint)")),i.push("checkNextInternalIntersection(".concat(s,", ").concat(u,", position, direction, theta, facetNormal);"))}return{FACETS_DEFINITION:e.join("\n"),COMPUTE_ENTRY_POINT:t.join("\n\t"),CHECK_IF_INSIDE:r.join(" && "),COMPUTE_INTERNAL_INTERSECTION:i.join("\n\t"),RAY_DEPTH:a.Parameters.rayDepth.toString()}},e}();t.Drawer=u},667:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.registerFrame=void 0,r(457);var i=0,n=performance.now();setInterval((function(){var e=performance.now(),t=1e3*i/(e-n);n=e,i=0,Page.Canvas.setIndicatorText("fps-indicator",Math.round(t).toString())}),500),t.registerFrame=function(){i++}},169:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Gemstone=void 0;var i=r(11),n=r(61);function a(e){n.Parameters.verbose&&console.log("OBJ parsing:  ".concat(e))}r(457);var o={},s=function(){function e(t){e.mutualizeTrianglesVertices(t),this.nbTriangles=t.length,this.bufferData=e.buildBufferFromTriangles(t),this.facets=e.buildFacetsFromTriangles(t);for(var r=[],i=0,n=t;i<n.length;i++){var a=n[i];r.push(a.p1),r.push(a.p2),r.push(a.p3)}this.isConvex=e.checkConvexity(r,this.facets),this.isConvex||console.log("This shape is not convex :(.")}return e.loadGemstone=function(t,r){if("CUSTOM CUT"===t)r(e.customCut());else if(void 0!==o[t])r(o[t]);else{var i=new XMLHttpRequest;i.addEventListener("load",(function(){200===i.status?(void 0===o[t]&&(o[t]=e.fromObj(i.responseText)),r(o[t])):r(null)})),i.open("GET","models/".concat(t,"?v=").concat(Page.version)),i.send()}},e.fromObj=function(t){for(var r=t.split("\n"),i=[],n=[],o=0;o<r.length;o++){var s=r[o].trim(),u=s.split(/\s+/),c=u[0];if("v"===c){if(!(u.length>=4)){a("Ignoring line ".concat(o," because it does not have enough items: '").concat(s,"'."));continue}i.push({x:parseFloat(u[1]),y:parseFloat(u[2]),z:parseFloat(u[3])})}else{if("f"!==c){a("Ignoring line ".concat(o,": '").concat(s,"'."));continue}if(!(u.length>=4)){a("Ignoring line ".concat(o," because only triangular faces are supported: '").concat(s,"'."));continue}for(var l=3;l<u.length;l++){for(var h=[+u[1].split("/")[0],+u[l-1].split("/")[0],+u[l].split("/")[0]],d=0,f=h;d<f.length;d++){var g=f[d];(g<1||g>=i.length)&&a("Ignoring line ".concat(o," because vertex index ").concat(g," is out of range: '").concat(s,"'."))}n.push({p1:i[h[0]-1],p2:i[h[1]-1],p3:i[h[2]-1]})}}}return new e(n)},e.customCut=function(){var t=e.computeBrilliantCut();return new e(t)},e.buildBufferFromTriangles=function(e){for(var t=new Float32Array(18*e.length),r=0,n=0,a=e;n<a.length;n++){var o=a[n],s=(0,i.computeTriangleNormal)(o);t[r++]=o.p1.x,t[r++]=o.p1.y,t[r++]=o.p1.z,t[r++]=s.x,t[r++]=s.y,t[r++]=s.z,t[r++]=o.p2.x,t[r++]=o.p2.y,t[r++]=o.p2.z,t[r++]=s.x,t[r++]=s.y,t[r++]=s.z,t[r++]=o.p3.x,t[r++]=o.p3.y,t[r++]=o.p3.z,t[r++]=s.x,t[r++]=s.y,t[r++]=s.z}return t},e.buildFacetsFromTriangles=function(e){for(var t=[],r=0,n=e;r<n.length;r++){for(var a=n[r],o=!1,s=0,u=t;s<u.length;s++){var c=u[s];if((0,i.isInPlane)(c,a.p1)&&(0,i.isInPlane)(c,a.p2)&&(0,i.isInPlane)(c,a.p3)){o=!0;break}}o||t.push((0,i.computePlaneFromTriangle)(a))}return t},e.checkConvexity=function(e,t){for(var r=0,n=e;r<n.length;r++){var a=n[r];if(!(0,i.isInsideVolume)(t,a))return!1}return!0},e.computeBrilliantCut=function(){for(var e=.5,t=n.Parameters.customCutPavillionHeight,r=n.Parameters.customCutPavillionRati,a=n.Parameters.customCutGirdleThickness,o=n.Parameters.customCutGirdleRoundess,s=n.Parameters.customCutCrownHeight,u=n.Parameters.customCutCrownRatio,c=n.Parameters.customCutCrownTable,l=a+s,h={x:0,y:0,z:-t},d=(0,i.cylindric)((1-r)*e/Math.cos(2*Math.PI/16),2*Math.PI/8,-t*r),f=(0,i.rotateZ)(d,-2*Math.PI/8),g=(0,i.cylindric)(e,4*Math.PI/16,0),p=(0,i.cylindric)(e,2*Math.PI/16,0),b=(0,i.cylindric)(e,0*Math.PI/16,0),v={x:g.x,y:g.y,z:a},m={x:p.x,y:p.y,z:a},y={x:b.x,y:b.y,z:a},P=(0,i.cylindric)(.5*(1*(1-u)+u*c)/Math.cos(2*Math.PI/16),2*Math.PI/8,a+u*s),T=(0,i.rotateZ)(P,-2*Math.PI/8),x=(0,i.cylindric)(.5*c,2*Math.PI/16,l),O=(0,i.cylindric)(.5*c,-2*Math.PI/16,l),_={x:0,y:0,z:l},R=(0,i.computePlaneFromTriangle)({p1:f,p3:b,p2:p}),E=(0,i.computePlaneFromTriangle)({p1:d,p3:p,p2:g}),A=(0,i.computePlaneFromTriangle)({p1:m,p3:y,p2:T}),C=(0,i.computePlaneFromTriangle)({p1:v,p3:m,p2:P}),S=[],w=0;w<2;w++)for(var M=0===w?R:E,I=0===w?A:C,z=0===w?f:d,F=0===w?T:P,L=o+2,j=2*Math.PI/16/(L-1),D=2*w*Math.PI/16,B=0;B<L-1;B++){var V=D+B*j,k=(0,i.computeIntersection)((0,i.cylindric)(e,V,0),{x:0,y:0,z:1},M),N=(0,i.computeIntersection)((0,i.cylindric)(e,V+j,0),{x:0,y:0,z:1},M),U=(0,i.computeIntersection)((0,i.cylindric)(e,V,0),{x:0,y:0,z:1},I),G=(0,i.computeIntersection)((0,i.cylindric)(e,V+j,0),{x:0,y:0,z:1},I);S.push({p1:z,p3:k,p2:N}),S.push({p1:N,p3:k,p2:U}),S.push({p1:N,p3:U,p2:G}),S.push({p1:F,p3:G,p2:U})}S.push({p1:h,p3:f,p2:p}),S.push({p1:h,p3:p,p2:d}),S.push({p1:x,p3:O,p2:_}),S.push({p1:x,p3:T,p2:O}),S.push({p1:m,p3:T,p2:x}),S.push({p1:m,p3:x,p2:P});for(var H=S.length,W=1;W<8;W++)for(var Y=0;Y<H;Y++)S.push({p1:(0,i.rotateZ)(S[Y].p1,2*W*Math.PI/8),p2:(0,i.rotateZ)(S[Y].p2,2*W*Math.PI/8),p3:(0,i.rotateZ)(S[Y].p3,2*W*Math.PI/8)});return S},e.mutualizeTrianglesVertices=function(e){var t=0,r={},i=Math.pow(10,8);function n(e){return Math.round(i*e)}function o(e){var i="".concat(n(e.x),"_").concat(n(e.y),"_").concat(n(e.z));return void 0===r[i]?r[i]=e:t++,r[i]}for(var s=0,u=e;s<u.length;s++){var c=u[s];c.p1=o(c.p1),c.p2=o(c.p2),c.p3=o(c.p3)}a("After mutualization: ".concat(Object.keys(r).length," vertices (saved ").concat(t," vertices)."))},e}();t.Gemstone=s},11:function(e,t){function r(e){var t,r,i,a,o=n(e.p2,e.p1),s=(r=n(e.p3,e.p1),{x:(t=o).y*r.z-t.z*r.y,y:t.z*r.x-t.x*r.z,z:t.x*r.y-t.y*r.x});return i=s,(a=Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z))>0?(i.x/=a,i.y/=a,i.z/=a):(i.x=1,i.y=0,i.z=0),s}function i(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}function n(e,t){return{x:e.x-t.x,y:e.y-t.y,z:e.z-t.z}}function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r={x:0,y:0,z:0},i=0,n=e;i<n.length;i++){var a=n[i];r.x+=a.x,r.y+=a.y,r.z+=a.z}var o=e.length;return r.x/=o,r.y/=o,r.z/=o,r}Object.defineProperty(t,"__esModule",{value:!0}),t.rotateZ=t.isInsideVolume=t.isInPlane=t.cylindric=t.computeTriangleNormal=t.computePlaneFromTriangle=t.computeIntersection=t.averagePoint=void 0,t.computeTriangleNormal=r,t.averagePoint=a,t.isInPlane=function(e,t){var r=n(t,e.point);return Math.abs(i(e.normal,r))<.001},t.isInsideVolume=function(e,t){for(var r=0,a=e;r<a.length;r++){var o=a[r],s=n(t,o.point);if(i(o.normal,s)>.001)return!1}return!0},t.rotateZ=function(e,t){var r=Math.cos(t),i=Math.sin(t);return{x:r*e.x-i*e.y,y:i*e.x+r*e.y,z:e.z}},t.cylindric=function(e,t,r){return{x:e*Math.cos(t),y:e*Math.sin(t),z:r}},t.computeIntersection=function(e,t,r){var a=i(t,r.normal);if(0!==a){var o=i(n(r.point,e),r.normal)/a;return{x:e.x+o*t.x,y:e.y+o*t.y,z:e.z+o*t.z}}return e},t.computePlaneFromTriangle=function(e){return{point:a(e.p1,e.p2,e.p3),normal:r(e)}}},753:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.gl=t.initGL=t.adjustSize=void 0,r(457);var i=null;t.gl=i,t.initGL=function(e){function r(e){Page.Demopage.setErrorMessage("webgl-support",e)}var n=Page.Canvas.getCanvas();if(t.gl=i=n.getContext("webgl",e),null==i){if(t.gl=i=n.getContext("experimental-webgl",e),null==i)return r("Your browser or device does not seem to support WebGL."),!1;r("Your browser or device only supports experimental WebGL.\nThe simulation may not run as expected.")}return i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.BLEND),i.clearColor(0,0,0,1),!0},t.adjustSize=function(e){void 0===e&&(e=!1);var t=e?window.devicePixelRatio:1,r=i.canvas,n=Math.floor(r.clientWidth*t),a=Math.floor(r.clientHeight*t);r.width===n&&r.height===a||(r.width=n,r.height=a)}},771:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.GLResource=void 0;var r=function(){function e(e){this._gl=e}return e.prototype.gl=function(){return this._gl},e}();t.GLResource=r},748:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteShader=t.registerShader=t.getShader=t.buildShader=void 0;var o=r(753),s=r(490),u=a(r(71)),c={};function l(e,t){var r=2,i=0;function n(n){function a(t){return t.replace(/#INJECT\(([^)]*)\)/gm,(function(t,r){return e.injected[r]?e.injected[r]:t}))}if(r--,n||i++,0===r){var c=null;if(0===i){var l=u.getSource(e.vertexFilename),h=u.getSource(e.fragmentFilename),d=a(l),f=a(h);c=new s.Shader(o.gl,d,f)}t(c)}}u.loadSource(e.vertexFilename,n),u.loadSource(e.fragmentFilename,n)}t.getShader=function(e){return c[e].shader},t.buildShader=l,t.registerShader=function(e,t,r){function i(e){for(var t=0,r=e.callbacks;t<r.length;t++)(0,r[t])(!e.failed,e.shader);e.callbacks=[]}if(void 0===c[e]){c[e]={callbacks:[r],failed:!1,infos:t,pending:!0,shader:null};var n=c[e];l(t,(function(e){n.pending=!1,n.failed=null===e,n.shader=e,i(n)}))}else{var a=c[e];!0===a.pending?a.callbacks.push(r):i(a)}},t.deleteShader=function(e){void 0!==c[e]&&(null!==c[e].shader&&c[e].shader.freeGLResources(),delete c[e])}},71:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.loadSource=t.getSource=void 0;var r={};t.loadSource=function(e,t){function i(e){for(var t=0,r=e.callbacks;t<r.length;t++)(0,r[t])(!e.failed);e.callbacks=[]}if(void 0===r[e]){r[e]={callbacks:[t],failed:!1,pending:!0,text:null};var n=r[e],a="./shaders/"+e;void 0!==Page.version&&(a+="?v=".concat(Page.version));var o=new XMLHttpRequest;o.open("GET",a,!0),o.onload=function(){4===o.readyState&&(n.pending=!1,200===o.status?(n.text=o.responseText,n.failed=!1):(console.error("Cannot load '".concat(e,"' shader source: ").concat(o.statusText)),n.failed=!0),i(n))},o.onerror=function(){console.error("Cannot load '".concat(e,"' shader source: ").concat(o.statusText)),n.pending=!1,n.failed=!0,i(n)},o.send(null)}else{var s=r[e];!0===s.pending?s.callbacks.push(t):(s.callbacks=[t],i(s))}},t.getSource=function(e){return r[e].text}},490:function(e,t,r){var i,n=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Shader=void 0;var a=r(771);function o(){alert("NOT IMPLEMENTED YET")}var s={35664:{str:"FLOAT_VEC2",binder:function(e,t,r){e.uniform2fv(t,r)}},35665:{str:"FLOAT_VEC3",binder:function(e,t,r){e.uniform3fv(t,r)}},35666:{str:"FLOAT_VEC4",binder:function(e,t,r){e.uniform4fv(t,r)}},35667:{str:"INT_VEC2",binder:function(e,t,r){e.uniform2iv(t,r)}},35668:{str:"INT_VEC3",binder:function(e,t,r){e.uniform3iv(t,r)}},35669:{str:"INT_VEC4",binder:function(e,t,r){e.uniform4iv(t,r)}},35670:{str:"BOOL",binder:function(e,t,r){e.uniform1i(t,+r)}},35671:{str:"BOOL_VEC2",binder:function(e,t,r){e.uniform2iv(t,r)}},35672:{str:"BOOL_VEC3",binder:function(e,t,r){e.uniform3iv(t,r)}},35673:{str:"BOOL_VEC4",binder:function(e,t,r){e.uniform4iv(t,r)}},35674:{str:"FLOAT_MAT2",binder:function(e,t,r){e.uniformMatrix2fv(t,!1,r)}},35675:{str:"FLOAT_MAT3",binder:function(e,t,r){e.uniformMatrix3fv(t,!1,r)}},35676:{str:"FLOAT_MAT4",binder:function(e,t,r){e.uniformMatrix4fv(t,!1,r)}},35678:{str:"SAMPLER_2D",binder:function(e,t,r,i){e.uniform1i(t,r),e.activeTexture(e["TEXTURE"+r]),e.bindTexture(e.TEXTURE_2D,i)}},35680:{str:"SAMPLER_CUBE",binder:function(e,t,r,i){e.uniform1i(t,r),e.activeTexture(e["TEXTURE"+r]),e.bindTexture(e.TEXTURE_CUBE_MAP,i)}},5120:{str:"BYTE",binder:o},5121:{str:"UNSIGNED_BYTE",binder:o},5122:{str:"SHORT",binder:o},5123:{str:"UNSIGNED_SHORT",binder:o},5124:{str:"INT",binder:function(e,t,r){Array.isArray(r),e.uniform1iv(t,r)}},5125:{str:"UNSIGNED_INT",binder:o},5126:{str:"FLOAT",binder:function(e,t,r){Array.isArray(r)?e.uniform1fv(t,r):e.uniform1f(t,r)}}},u=function(e){function t(t,r,i){var n=this;function a(e,r){var i=t.createShader(e);return t.shaderSource(i,r),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:(console.error(t.getShaderInfoLog(i)),console.log(r),t.deleteShader(i),null)}(n=e.call(this,t)||this).id=null,n.uCount=0,n.aCount=0;var o=a(t.VERTEX_SHADER,r),s=a(t.FRAGMENT_SHADER,i),u=t.createProgram();return t.attachShader(u,o),t.attachShader(u,s),t.linkProgram(u),t.getProgramParameter(u,t.LINK_STATUS)?(n.id=u,n.introspection()):(console.error(t.getProgramInfoLog(u)),t.deleteProgram(u)),n}return n(t,e),t.prototype.freeGLResources=function(){e.prototype.gl.call(this).deleteProgram(this.id),this.id=null},t.prototype.use=function(){e.prototype.gl.call(this).useProgram(this.id)},t.prototype.bindUniforms=function(){var t=this,r=e.prototype.gl.call(this),i=0;Object.keys(this.u).forEach((function(e){var n=t.u[e];if(null!==n.value)if(35678===n.type||35680===n.type){var a=i;s[n.type].binder(r,n.loc,a,n.value),i++}else s[n.type].binder(r,n.loc,n.value)}))},t.prototype.bindAttributes=function(){var e=this;Object.keys(this.a).forEach((function(t){var r=e.a[t];null!==r.VBO&&r.VBO.bind(r.loc)}))},t.prototype.bindUniformsAndAttributes=function(){this.bindUniforms(),this.bindAttributes()},t.prototype.introspection=function(){var t=e.prototype.gl.call(this);this.uCount=t.getProgramParameter(this.id,t.ACTIVE_UNIFORMS),this.u={};for(var r=0;r<this.uCount;r++){var i=t.getActiveUniform(this.id,r),n=i.name;this.u[n]={loc:t.getUniformLocation(this.id,n),size:i.size,type:i.type,value:null}}for(this.aCount=t.getProgramParameter(this.id,t.ACTIVE_ATTRIBUTES),this.a={},r=0;r<this.aCount;r++){var a=t.getActiveAttrib(this.id,r),o=a.name;this.a[o]={VBO:null,loc:t.getAttribLocation(this.id,o),size:a.size,type:a.type}}},t}(a.GLResource);t.Shader=u},62:function(e,t,r){var i,n=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.VBO=void 0;var a,o=r(771);!function(e){e[e.DYNAMIC=0]="DYNAMIC",e[e.STATIC=1]="STATIC"}(a||(a={}));var s=function(e){function t(t,r,i,n,o){void 0===o&&(o=!0);var s=e.call(this,t)||this;return s.id=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,s.id),o?t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW):t.bufferData(t.ARRAY_BUFFER,r,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),s.size=i,s.type=n,s.normalize=!1,s.stride=0,s.offset=0,s.usage=o?a.STATIC:a.DYNAMIC,s}return n(t,e),t.createQuad=function(e,r,i,n,a){return new t(e,new Float32Array([r,i,n,i,r,a,n,a]),2,e.FLOAT,!0)},t.prototype.freeGLResources=function(){this.gl().deleteBuffer(this.id),this.id=null},t.prototype.bind=function(t){var r=e.prototype.gl.call(this);r.enableVertexAttribArray(t),r.bindBuffer(r.ARRAY_BUFFER,this.id),r.vertexAttribPointer(t,this.size,this.type,this.normalize,this.stride,this.offset)},t.prototype.setData=function(t){var r=e.prototype.gl.call(this);r.bindBuffer(r.ARRAY_BUFFER,this.id),this.usage===a.STATIC?r.bufferData(r.ARRAY_BUFFER,t,r.STATIC_DRAW):r.bufferData(r.ARRAY_BUFFER,t,r.DYNAMIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,null)},t}(o.GLResource);t.VBO=s},883:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Viewport=void 0;var r=function(){function e(e,t,r,i){this.left=e,this.lower=t,this.width=r,this.height=i}return e.setFullCanvas=function(e){e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight)},e.prototype.set=function(e){e.viewport(this.lower,this.left,this.width,this.height)},e}();t.Viewport=r},817:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.LazyShader=void 0;var o,s=a(r(748));r(457),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(o||(o={}));var u=0,c=function(){function e(e,t,r){this.fragmentShaderName=e,this.vertexShaderName=t,this.errorKey="shader_fail_".concat(u++),this.errorMessage="Failed to load or build the shader '".concat(r,"'."),this.loadingState=o.NOT_LOADED,this.injected={}}return Object.defineProperty(e.prototype,"shader",{get:function(){return this.loadingState===o.NOT_LOADED&&this.requestLoading(),this._shader?this._shader:null},enumerable:!1,configurable:!0}),e.prototype.reset=function(e){this.loadingState=o.NOT_LOADED,this.injected=e,this._shader&&(this._shader.freeGLResources(),this._shader=null)},e.prototype.requestLoading=function(){var e=this;this.loadingState=o.LOADING,s.buildShader({fragmentFilename:this.fragmentShaderName,vertexFilename:this.vertexShaderName,injected:this.injected},(function(t){e.loadingState=o.LOADED,null!==t?e._shader=t:Page.Demopage.setErrorMessage(e.errorKey,e.errorMessage)}))},e}();t.LazyShader=c},633:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});var o=a(r(753)),s=r(753),u=r(883),c=r(592),l=a(r(667)),h=r(169),d=r(61),f=r(513),g=r(532);r(457),function(){if((0,f.registerPolyfills)(),o.initGL({alpha:!1,antialias:!1,depth:!1,stencil:!1,preserveDrawingBuffer:!1})){var e=!0;d.Parameters.addCanvasResizeObservers((function(){e=!0}));var t=new c.Drawer(s.gl),r=new g.PostProcessing(s.gl);d.Parameters.addCutChangeObserver(n),n();var i=0;!function n(){var a=performance.now(),c=performance.now()-i;i=a,l.registerFrame(),e&&(o.adjustSize(d.Parameters.highDPI),u.Viewport.setFullCanvas(s.gl),e=!1),d.Parameters.autoRotate&&!Page.Canvas.isMouseDown()&&t.rotate(1e-4*c),d.Parameters.displayRaytracedVolume?t.drawDebugVolume():d.Parameters.postProcessing&&r.isReady()?(r.prepare(),t.draw(),r.apply()):t.draw(),requestAnimationFrame(n)}()}function n(){h.Gemstone.loadGemstone(d.Parameters.cut,(function(e){t.setGemstone(e)}))}}()},841:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.OrbitalCamera=void 0;var r=function(){function e(e,t){this._focus=e,this._distance=t,this._theta=0,this._phi=.01,this._eyePos=[0,0,0],this._viewMatrix=mat4.create(),this.recompute()}return Object.defineProperty(e.prototype,"focusPoint",{get:function(){return this._focus},set:function(e){this._focus=e,this.recompute()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},set:function(e){this._distance=e,this.recompute()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"theta",{get:function(){return this._theta},set:function(e){this._theta=e,this.recompute()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"phi",{get:function(){return this._phi},set:function(e){this._phi=e,this.recompute()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"eyePos",{get:function(){return this._eyePos},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewMatrix",{get:function(){return this._viewMatrix},enumerable:!1,configurable:!0}),e.prototype.recompute=function(){var e=Math.sin,t=Math.cos;this._eyePos[0]=this.focusPoint[0]+this.distance*(e(this.phi)*t(this.theta)),this._eyePos[1]=this.focusPoint[1]+this.distance*(e(this.phi)*e(this.theta)),this._eyePos[2]=this.focusPoint[2]+this.distance*t(this.phi),this._viewMatrix=mat4.lookAt(this._viewMatrix,this.eyePos,this.focusPoint,[0,0,1])},e}();t.OrbitalCamera=r},457:function(){},61:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Parameters=t.EProjection=t.ELightType=t.ELightDirection=void 0,r(457);var i,n,a,o="gem-cut-picker-id",s="gem-color-picker-id",u="ray-depth-range-id",c="display-skybox-checkbox-id",l="background-color-picker-id",h="projection-tabs-id",d="high-dpi-checkbox-id",f="display-indicators-checkbox-id",g="custom-cut-crown-height-range-id",p="custom-cut-crown-table-range-id",b="custom-cut-crown-ratio-range-id",v="custom-cut-girdle-thickness-range-id",m="custom-cut-girdle-roundness-range-id",y="custom-cut-pavillion-height-range-id",P="custom-cut-pavillion-ratio-range-id";function T(e){for(var t=0,r=e;t<r.length;t++)(0,r[t])()}!function(e){e.WHITE="white",e.ASET="aset"}(i||(i={})),t.ELightType=i,function(e){e.DOWNWARD="downward",e.UPWARD="upward"}(n||(n={})),t.ELightDirection=n,function(e){e.PERSPECTIVE="perspective",e.ORTHOGRAPHIC="orthographic"}(a||(a={})),t.EProjection=a;var x=[],O=function(){T(x)};Page.Picker.addObserver(o,O),Page.Range.addLazyObserver(g,O),Page.Range.addLazyObserver(p,O),Page.Range.addLazyObserver(b,O),Page.Range.addLazyObserver(v,O),Page.Range.addLazyObserver(m,O),Page.Range.addLazyObserver(y,O),Page.Range.addLazyObserver(P,O);var _=[];Page.Range.addLazyObserver(u,(function(){T(_)}));var R=[],E=function(){T(R)};Page.Canvas.Observers.canvasResize.push(E),Page.Checkbox.addObserver(d,E);var A=[];Page.Tabs.addObserver(h,(function(){T(A)}));var C=[],S={r:0,g:0,b:0};function w(){var e=Page.ColorPicker.getValue(l);S.r=e.r,S.g=e.g,S.b=e.b,T(C)}Page.ColorPicker.addObserver(l,w),w();var M={r:0,g:0,b:0};function I(){var e=Page.ColorPicker.getValue(s);M.r=e.r,M.g=e.g,M.b=e.b}Page.ColorPicker.addObserver(s,I),I();var z=function(){function e(){}return Object.defineProperty(e,"cut",{get:function(){return Page.Picker.getValue(o)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"refractionIndex",{get:function(){return Page.Range.getValue("refraction-range-id")},enumerable:!1,configurable:!0}),Object.defineProperty(e,"displaySkybox",{get:function(){return Page.Checkbox.isChecked(c)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"backgroundColor",{get:function(){return S},enumerable:!1,configurable:!0}),Object.defineProperty(e,"gemColor",{get:function(){return M},enumerable:!1,configurable:!0}),Object.defineProperty(e,"absorption",{get:function(){return Page.Range.getValue("absorption-range-id")},enumerable:!1,configurable:!0}),Object.defineProperty(e,"dispersion",{get:function(){return Page.Range.getValue("dispersion-range-id")},enumerable:!1,configurable:!0}),Object.defineProperty(e,"rayDepth",{get:function(){return Math.ceil(Page.Range.getValue(u))},enumerable:!1,configurable:!0}),Object.defineProperty(e,"displayReflection",{get:function(){return Page.Checkbox.isChecked("reflection-checkbox-id")},enumerable:!1,configurable:!0}),Object.defineProperty(e,"displayRaytracedVolume",{get:function(){return Page.Checkbox.isChecked("raytraced-volume-checkbox-id")},enumerable:!1,configurable:!0}),Object.defineProperty(e,"displayNormals",{get:function(){return Page.Checkbox.isChecked("display-normals-checkbox-id")},enumerable:!1,configurable:!0}),Object.defineProperty(e,"verbose",{get:function(){return Page.Checkbox.isChecked("verbose-checkbox-id")},enumerable:!1,configurable:!0}),Object.defineProperty(e,"projection",{get:function(){return Page.Tabs.getValues(h)[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"geometryOnly",{get:function(){return Page.Checkbox.isChecked("only-normals-checkbox-id")},enumerable:!1,configurable:!0}),Object.defineProperty(e,"autoRotate",{get:function(){return Page.Checkbox.isChecked("auto-rotate-checkbox-id")},enumerable:!1,configurable:!0}),Object.defineProperty(e,"postProcessing",{get:function(){return Page.Checkbox.isChecked("post-processing-checkbox-id")},enumerable:!1,configurable:!0}),Object.defineProperty(e,"highDPI",{get:function(){return Page.Checkbox.isChecked(d)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"lightType",{get:function(){return Page.Tabs.getValues("light-type-tabs-id")[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"lightDirection",{get:function(){return Page.Tabs.getValues("light-direction-tabs-id")[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"customCutCrownHeight",{get:function(){return Page.Range.getValue(g)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"customCutCrownTable",{get:function(){return Page.Range.getValue(p)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"customCutCrownRatio",{get:function(){return Page.Range.getValue(b)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"customCutGirdleThickness",{get:function(){return Page.Range.getValue(v)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"customCutGirdleRoundess",{get:function(){return Page.Range.getValue(m)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"customCutPavillionHeight",{get:function(){return Page.Range.getValue(y)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"customCutPavillionRati",{get:function(){return Page.Range.getValue(P)},enumerable:!1,configurable:!0}),e.addCutChangeObserver=function(e){x.push(e)},e.addBackgroundColorObserver=function(e){C.push(e)},e.addRecomputeShaderObservers=function(e){_.push(e)},e.addCanvasResizeObservers=function(e){R.push(e)},e.addCameraChangeObservers=function(e){A.push(e)},e}();function F(){Page.Sections.setVisibility("custom-cut-section","CUSTOM CUT"===z.cut)}function L(){var e=Page.Checkbox.isChecked(f);Page.Canvas.setIndicatorsVisibility(e)}function j(){Page.Controls.setVisibility(l,!z.displaySkybox)}t.Parameters=z,z.addCutChangeObserver(F),F(),Page.Controls.setVisibility(d,window.devicePixelRatio>1),Page.Checkbox.addObserver(f,L),L(),Page.Checkbox.addObserver(c,j),j();var D=!1;"undefined"!=typeof URLSearchParams&&(D="1"===new URLSearchParams(window.location.search).get("debug")),Page.Sections.setVisibility("debug-section-id",D)},532:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.PostProcessing=void 0;var i=r(62),n=r(817),a=r(61),o=new Float32Array([-1,-1,1,-1,-1,1,1,1]),s=function(){function e(t){this.gl=t,this.squareVBO=new i.VBO(t,o,2,t.FLOAT,!0),this.downsizingShader=new n.LazyShader("post-processing/downsizing.frag","post-processing/fullscreen.vert","post-processing downsizing"),this.blurShader=new n.LazyShader("post-processing/blur.frag","post-processing/fullscreen.vert","post-processing blur"),this.blurShader.reset({BLUR_INSTRUCTIONS:e.buildGlowInstructions1D(3)}),this.compositingShader=new n.LazyShader("post-processing/compositing.frag","post-processing/fullscreen.vert","post-processing downsizing"),this.fullSizeTexture=this.createTexture(),this.downsizedTexture=this.createTexture(),this.downsizedBlurredTexture=this.createTexture()}return e.prototype.isReady=function(){var e=!!this.downsizingShader.shader,t=!!this.blurShader.shader,r=!!this.compositingShader.shader;return e&&t&&r},e.prototype.prepare=function(){var e=1/(8*(a.Parameters.highDPI?window.devicePixelRatio:1));this.initializeTexture(this.fullSizeTexture,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.initializeTexture(this.downsizedTexture,e*this.fullSizeTexture.width,e*this.fullSizeTexture.height),this.initializeTexture(this.downsizedBlurredTexture,this.downsizedTexture.width,this.downsizedTexture.height),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fullSizeTexture.framebuffer),this.gl.viewport(0,0,this.fullSizeTexture.width,this.fullSizeTexture.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT)},e.prototype.apply=function(){var e=this.downsizingShader.shader,t=this.blurShader.shader,r=this.compositingShader.shader;e&&t&&r&&(e.a.aCorner.VBO=this.squareVBO,e.u.uTexture.value=this.fullSizeTexture.texture,e.use(),e.bindUniformsAndAttributes(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.downsizedTexture.framebuffer),this.gl.viewport(0,0,this.downsizedTexture.width,this.downsizedTexture.height),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),t.a.aCorner.VBO=this.squareVBO,t.u.uTexture.value=this.downsizedTexture.texture,t.u.uTexelSize.value=[1/this.downsizedTexture.width,1/this.downsizedTexture.height],t.use(),t.bindUniformsAndAttributes(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.downsizedBlurredTexture.framebuffer),this.gl.viewport(0,0,this.downsizedBlurredTexture.width,this.downsizedBlurredTexture.height),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),r.a.aCorner.VBO=this.squareVBO,r.u.uFullsizeTexture.value=this.fullSizeTexture.texture,r.u.uFullsizeTextureTexelSize.value=[1/this.fullSizeTexture.width,1/this.fullSizeTexture.height],r.u.uBlurredTexture.value=this.downsizedBlurredTexture.texture,r.use(),r.bindUniformsAndAttributes(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.gl.bindTexture(this.gl.TEXTURE_2D,null))},e.prototype.initializeTexture=function(e,t,r){if(t=Math.ceil(t),r=Math.ceil(r),e.width!==t||e.height!==r){this.gl.bindTexture(this.gl.TEXTURE_2D,e.texture);var i=this.gl.RGBA;this.gl.texImage2D(this.gl.TEXTURE_2D,0,i,t,r,0,i,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,e.framebuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,e.texture,0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.bindTexture(this.gl.TEXTURE_2D,null),e.width=t,e.height=r}},e.prototype.createTexture=function(){return{texture:this.gl.createTexture(),framebuffer:this.gl.createFramebuffer(),width:-1,height:-1}},e.buildGlowInstructions1D=function(e){function t(e){return Math.exp(-e*e/128)/Math.sqrt(2*Math.PI*8*8)}for(var r=0,i=-e-.5;i<=e;i++)r+=t(i);var n=[];for(i=-e-.5;i<=e+.5;i++)n.push("blurred += ".concat(t(i)/r," * contribution(vec2(").concat(i,", ").concat(i,"));")),n.push("blurred += ".concat(t(i)/r," * contribution(vec2(").concat(i,", ").concat(-i,"));"));return n.push("blurred *= 0.5;"),n.push("blurred *= 0.5;"),n.join("\n\t")},e}();t.PostProcessing=s},513:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.registerPolyfills=void 0,t.registerPolyfills=function(){"function"!=typeof String.prototype.startsWith&&(console.log("Registering polyfill for '".concat("String.startsWith","'.")),String.prototype.startsWith=function(e){return 0===this.indexOf(e)})}}},t={};!function r(i){var n=t[i];if(void 0!==n)return n.exports;var a=t[i]={exports:{}};return e[i].call(a.exports,a,a.exports,r),a.exports}(633)}();
//# sourceMappingURL=main.min.js.map